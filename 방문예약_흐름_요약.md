# 광동제약 방문예약 시스템 - 흐름 요약

## 전체 흐름 개요

```
[방문자] 예약 신청 → [관리자] 승인/반려 → [방문자] 방문 → [임직원] 체크인
```

---

## 1. 예약 신청 (방문자)

| 단계 | 경로 | 설명 |
|------|------|------|
| 1) 공장 선택 | `/` (홈) | GMP공장 또는 식품공장 선택 |
| 2) 약관 동의 | `/reservation/agreement` | 방문 안전·개인정보 등 약관 동의 (30분 유효) |
| 3) 예약 폼 입력 | `/reservation/form` | 방문 목적, 일시, 방문자 정보, 담당자 등 입력 |
| 4) 예약 완료 | `/reservation/complete` | 예약번호 발급, DB에 `visit_requests` 생성 |

**생성 데이터**: `visit_requests` (status: `REQUESTED`), `visitor_info`, `checklists`

---

## 2. 승인 (관리자)

| 경로 | 담당 | 설명 |
|------|------|------|
| `/admin/approval` | 관리자 | 대기 중 예약 목록 조회, 승인/반려 처리 |
| `/employee` (승인 탭) | 임직원 | 동일한 승인 기능 제공 |

**승인 시**:
- `status` → `APPROVED`
- QR 코드 생성
- SMS 발송 (방문자에게 예약번호·QR 링크 전송)

**반려 시**:
- `status` → `REJECTED`
- `rejection_reason` 저장

---

## 3. 방문 (방문자)

| 경로 | 설명 |
|------|------|
| `/progress` | 예약번호 또는 QR로 진행 상황 조회 |
| `/qr/:id` | SMS 링크 클릭 시 QR 코드 표시 |

**방문자**: 승인된 QR 코드를 휴대하여 방문

---

## 4. 체크인 (임직원)

| 경로 | 설명 |
|------|------|
| `/employee?tab=checkin` | QR 스캔 또는 예약번호 입력으로 체크인 |

**체크인 시**:
- `status` → `IN_PROGRESS`
- `checked_in_at` 기록

---

## 예약 상태 (visit_status)

| 상태 | 의미 |
|------|------|
| `REQUESTED` | 예약 신청됨 (승인 대기) |
| `APPROVED` | 승인됨 (방문 가능) |
| `REJECTED` | 반려됨 |
| `IN_PROGRESS` | 체크인 완료 (방문 중) |
| `COMPLETED` | 방문 완료 |
| `CANCELLED` | 취소됨 |

---

## 향후 확장 (2단계 승인)

- **1단계**: 담당자 승인 → `MANAGER_APPROVED`
- **2단계**: 부서 승인자 승인 → QR 생성 + SMS 발송 → `APPROVED`
